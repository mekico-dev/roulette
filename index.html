<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>ãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆï¼ã€Œã‚·ãƒ¼ãƒ«ã¨ã‹ã‚‚ã‚‰ãˆï½ã‚‹ã€</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- PWA ç”¨ -->
  <meta name="theme-color" content="#f5f5f5" />
  <link rel="manifest" href="manifest.webmanifest" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <!-- iOS ã®ãƒ›ãƒ¼ãƒ ç”»é¢ã‚¢ã‚¤ã‚³ãƒ³ï¼ˆã‚ã¨ã§ä½œã‚‹ï¼‰ -->
  <link rel="apple-touch-icon" href="icon-192.png" />

  <style>
    /* --- å…¨ä½“ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ --- */
    body {
      font-family: system-ui, sans-serif;
      background: #f5f5f5;       /* å¤–å´ã¯ã‚·ãƒ³ãƒ—ãƒ«ã« */
      margin: 0;
      padding: 16px;
      display: flex;
      justify-content: center;
      color: #8B4513;
    }

    .app {
      max-width: 540px;
      width: 100%;
      box-sizing: border-box;
      position: relative;

      /* â–¼ ã‚«ãƒ¼ãƒ‰éƒ¨åˆ†ã ã‘ã«èƒŒæ™¯ç”»åƒã‚’é©ç”¨ */
      background-image: url('bg.png');   /* â† ã“ã“ã‚’è‡ªåˆ†ã®ãƒ•ã‚¡ã‚¤ãƒ«åã« */
      background-size: cover;
      background-position: center;

      padding: 16px 16px 24px;
      border-radius: 16px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.08);
    }

    /* èƒŒæ™¯å…¨ä½“ã®ç™½ã„æ˜Ÿã‚­ãƒ©ã‚­ãƒ© */
    .app::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-image: 
        radial-gradient(circle at 15% 20%, rgba(255, 255, 255, 1) 0%, rgba(255, 255, 255, 0.5) 3px, transparent 6px),
        radial-gradient(circle at 85% 15%, rgba(255, 255, 255, 0.9) 0%, rgba(255, 255, 255, 0.4) 2px, transparent 5px),
        radial-gradient(circle at 40% 60%, rgba(255, 255, 255, 1) 0%, rgba(255, 255, 255, 0.5) 3px, transparent 6px),
        radial-gradient(circle at 70% 80%, rgba(255, 255, 255, 0.8) 0%, rgba(255, 255, 255, 0.3) 2px, transparent 5px),
        radial-gradient(circle at 25% 85%, rgba(255, 255, 255, 1) 0%, rgba(255, 255, 255, 0.6) 3px, transparent 6px),
        radial-gradient(circle at 90% 50%, rgba(255, 255, 255, 0.9) 0%, rgba(255, 255, 255, 0.4) 2px, transparent 5px),
        radial-gradient(circle at 55% 25%, rgba(255, 255, 255, 1) 0%, rgba(255, 255, 255, 0.5) 3px, transparent 6px),
        radial-gradient(circle at 10% 45%, rgba(255, 255, 255, 0.8) 0%, rgba(255, 255, 255, 0.3) 2px, transparent 5px),
        radial-gradient(circle at 75% 35%, rgba(255, 255, 255, 1) 0%, rgba(255, 255, 255, 0.5) 3px, transparent 6px),
        radial-gradient(circle at 30% 70%, rgba(255, 255, 255, 0.9) 0%, rgba(255, 255, 255, 0.4) 2px, transparent 5px),
        radial-gradient(circle at 95% 75%, rgba(255, 255, 255, 1) 0%, rgba(255, 255, 255, 0.5) 3px, transparent 6px),
        radial-gradient(circle at 50% 90%, rgba(255, 255, 255, 0.8) 0%, rgba(255, 255, 255, 0.3) 2px, transparent 5px),
        radial-gradient(circle at 65% 10%, rgba(255, 255, 255, 1) 0%, rgba(255, 255, 255, 0.6) 3px, transparent 6px),
        radial-gradient(circle at 20% 30%, rgba(255, 255, 255, 0.9) 0%, rgba(255, 255, 255, 0.4) 2px, transparent 5px),
        radial-gradient(circle at 80% 65%, rgba(255, 255, 255, 1) 0%, rgba(255, 255, 255, 0.5) 3px, transparent 6px),
        radial-gradient(circle at 45% 15%, rgba(255, 255, 255, 0.9) 0%, rgba(255, 255, 255, 0.4) 2px, transparent 5px),
        radial-gradient(circle at 60% 55%, rgba(255, 255, 255, 1) 0%, rgba(255, 255, 255, 0.5) 3px, transparent 6px),
        radial-gradient(circle at 12% 65%, rgba(255, 255, 255, 0.8) 0%, rgba(255, 255, 255, 0.3) 2px, transparent 5px),
        radial-gradient(circle at 88% 30%, rgba(255, 255, 255, 1) 0%, rgba(255, 255, 255, 0.6) 3px, transparent 6px),
        radial-gradient(circle at 35% 40%, rgba(255, 255, 255, 0.9) 0%, rgba(255, 255, 255, 0.4) 2px, transparent 5px),
        radial-gradient(circle at 78% 92%, rgba(255, 255, 255, 1) 0%, rgba(255, 255, 255, 0.5) 3px, transparent 6px),
        radial-gradient(circle at 5% 10%, rgba(255, 255, 255, 0.8) 0%, rgba(255, 255, 255, 0.3) 2px, transparent 5px),
        radial-gradient(circle at 48% 78%, rgba(255, 255, 255, 1) 0%, rgba(255, 255, 255, 0.6) 3px, transparent 6px),
        radial-gradient(circle at 92% 88%, rgba(255, 255, 255, 0.9) 0%, rgba(255, 255, 255, 0.4) 2px, transparent 5px),
        radial-gradient(circle at 22% 52%, rgba(255, 255, 255, 1) 0%, rgba(255, 255, 255, 0.5) 3px, transparent 6px),
        radial-gradient(circle at 68% 42%, rgba(255, 255, 255, 0.8) 0%, rgba(255, 255, 255, 0.3) 2px, transparent 5px),
        radial-gradient(circle at 38% 8%, rgba(255, 255, 255, 1) 0%, rgba(255, 255, 255, 0.6) 3px, transparent 6px),
        radial-gradient(circle at 82% 58%, rgba(255, 255, 255, 0.9) 0%, rgba(255, 255, 255, 0.4) 2px, transparent 5px),
        radial-gradient(circle at 52% 48%, rgba(255, 255, 255, 1) 0%, rgba(255, 255, 255, 0.5) 3px, transparent 6px),
        radial-gradient(circle at 18% 95%, rgba(255, 255, 255, 0.8) 0%, rgba(255, 255, 255, 0.3) 2px, transparent 5px);
      border-radius: 16px;
      pointer-events: none;
      animation: starTwinkle 0.5s ease-in-out infinite;
      z-index: 1;
      filter: drop-shadow(0 0 3px rgba(255, 255, 255, 0.8));
    }

    @keyframes starTwinkle {
      0%, 100% { opacity: 0.7; }
      50% { opacity: 1; }
    }

    /* å†…å´ã®è¦ç´ ã¯èª­ã¿ã‚„ã™ã„ã‚ˆã†ã«æ·¡ã„ãƒ‘ãƒãƒ«ã®ä¸Šã«è¼‰ã›ã‚‹ */
    .inner {
      background:transparent;
      border-radius: 16px;
      padding: 12px 12px 18px;
      position: relative;
      z-index: 2;
    }

    h1 {
      font-size: 20px;
      margin: 0 0 4px;
      text-align: center;
    }
    .subtitle {
      font-size: 12px;
      text-align: center;
      color: #777;
      margin-bottom: 12px;
    }

    .controls {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 12px;
      margin: 8px 0 16px;
      position: relative;
    }

    .reset-btn {
      padding: 16px 20px;
      font-size: 24px;
      min-width: auto;
      background: linear-gradient(135deg, 
        rgba(255, 182, 193, 0.7) 0%,
        rgba(173, 216, 230, 0.7) 50%,
        rgba(255, 255, 176, 0.7) 100%);
      backdrop-filter: blur(10px);
      border: 2px solid rgba(255, 182, 193, 0.8);
      color: #8B4513;
      animation: none;
      position: absolute;
      right: 0;
    }

    .reset-btn:hover:not(:disabled) {
      background: linear-gradient(135deg, 
        rgba(255, 182, 193, 0.85) 0%,
        rgba(173, 216, 230, 0.85) 50%,
        rgba(255, 255, 176, 0.85) 100%);
    }

    button {
      padding: 16px 48px;
      border-radius: 12px;
      border: 2px solid rgba(255, 182, 193, 0.8);
      font-size: 18px;
      cursor: pointer;
      background: linear-gradient(135deg, 
        rgba(255, 182, 193, 0.7) 0%,
        rgba(173, 216, 230, 0.7) 50%,
        rgba(255, 255, 176, 0.7) 100%);
      backdrop-filter: blur(10px);
      color: #8B4513;
      font-weight: 700;
      transition: transform 0.05s ease, box-shadow 0.05s ease, opacity 0.2s;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
      text-shadow: 0 1px 2px rgba(255, 255, 255, 0.8);
      animation: buttonBlink 1.5s ease-in-out infinite;
    }

    @keyframes buttonBlink {
      0%, 100% {
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
        transform: scale(1);
      }
      50% {
        box-shadow: 0 0 25px rgba(255, 182, 193, 0.8),
                    0 0 35px rgba(173, 216, 230, 0.6);
        transform: scale(1.05);
      }
    }

    button:disabled {
      opacity: 0.5;
      cursor: default;
      box-shadow: none;
      animation: none;
    }

    button:active:not(:disabled) {
      transform: translateY(1px);
      box-shadow: 0 2px 5px rgba(0,0,0,0.25);
    }

    .wheel-wrapper {
      position: relative;
      width: 100%;
      aspect-ratio: 1 / 1;
      max-width: 360px;
      max-height: 70vh;   /* â† ã“ã‚Œã‚’è¿½åŠ  */
      margin: 0 auto;
    }

    canvas {
      width: 100%;
      height: 100%;
      display: block;
    }

    .pointer {
      position: absolute;
      top: 50%;           /* â† ä¸Šç«¯ã‹ã‚‰çœŸã‚“ä¸­ã« */
      left: auto;         /* â† å·¦ã‹ã‚‰ã®æŒ‡å®šã‚’è§£é™¤ */
      right: -8px;        /* â† å³ç«¯ã‹ã‚‰å°‘ã—å‡ºã™ */
      transform: translateY(-50%) rotate(90deg);  /* â† ä¸­å¤®æƒãˆ + 90åº¦å›è»¢ */
      width: 0;
      height: 0;
      border-left: 14px solid transparent;
      border-right: 14px solid transparent;
      border-top: 24px solid #e53935;
      filter: drop-shadow(0 3px 4px rgba(0,0,0,0.3));
      z-index: 2;
    }

    .result {
      text-align: center;
      margin-top: 12px;
      min-height: 24px;
      font-size: 16px;
      font-weight: 600;
    }
    .result span {
      padding: 4px 10px;
      border-radius: 999px;
      background: #fff3cd;
      border: 1px solid #ffe08a;
    }

    .prize-list {
      margin-top: 12px;
      display: grid;
      grid-template-columns: repeat(2, minmax(0,1fr));
      gap: 8px;
    }

    .prize-card {
      border-radius: 12px;
      padding: 6px;
      border: 1px solid #ddd;
      display: flex;
      align-items: center;
      gap: 6px;
      background: #fafafa;
      transition: transform 0.1s, box-shadow 0.1s, border-color 0.1s;
    }

    .prize-card img {
      width: 52px;
      height: 52px;
      object-fit: cover;
      border-radius: 10px;
      background: #fff;
    }

    .prize-card .name {
      font-size: 13px;
    }

    .prize-card.selected {
      border-color: #ffb300;
      box-shadow: 0 0 0 4px rgba(255,179,0,0.4);
      transform: translateY(-2px);
      background: #fffdf5;
    }

    .footer-note {
      margin-top: 10px;
      font-size: 11px;
      color: #666;
      text-align: right;
    }

    /* ã‚­ãƒ©ã‚­ãƒ©ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ« */
    .sparkles {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.3s;
    }

    .sparkles.active {
      opacity: 1;
    }

    .sparkle {
      position: absolute;
      width: 16px;
      height: 16px;
      background: radial-gradient(circle, rgba(255, 255, 255, 1) 0%, rgba(255, 215, 0, 0.8) 50%, transparent 100%);
      border-radius: 50%;
      animation: sparkleFloat 2s ease-in-out infinite;
      box-shadow: 0 0 10px rgba(255, 215, 0, 0.8);
    }

    @keyframes sparkleFloat {
      0%, 100% {
        transform: translateY(0) scale(1);
        opacity: 0;
      }
      10% {
        opacity: 1;
      }
      50% {
        transform: translateY(-30px) scale(1.2);
        opacity: 1;
      }
      90% {
        opacity: 1;
      }
    }

    /* å½“é¸ã‚«ãƒ¼ãƒ‰ç”¨ã®èµ¤ã„ãƒãƒ¼ãƒˆã‚­ãƒ©ã‚­ãƒ© */
    .prize-card .heart-container {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      overflow: hidden;
      border-radius: 12px;
    }

    .heart-sparkle {
      position: absolute;
      width: 20px;
      height: 20px;
      animation: heartFloat 2s ease-in-out infinite;
      z-index: 10;
    }

    /* ãƒãƒ¼ãƒˆå½¢çŠ¶ */
    .heart-sparkle::before {
      content: 'â™¥';
      position: absolute;
      top: 0;
      left: 0;
      font-size: 20px;
      color: rgba(255, 80, 120, 0.8);
      text-shadow: 0 0 10px rgba(255, 80, 120, 0.6),
                   0 0 20px rgba(255, 150, 180, 0.4);
      animation: heartBeat 1s ease-in-out infinite;
    }

    @keyframes heartFloat {
      0% {
        transform: translate(0, 0) rotate(-10deg) scale(0.9);
        opacity: 0.7;
      }
      25% {
        transform: translate(5px, -10px) rotate(5deg) scale(1.1);
        opacity: 0.9;
      }
      50% {
        transform: translate(-3px, -18px) rotate(15deg) scale(1.2);
        opacity: 1;
      }
      75% {
        transform: translate(8px, -12px) rotate(-5deg) scale(1.05);
        opacity: 0.9;
      }
      100% {
        transform: translate(0, 0) rotate(-10deg) scale(0.9);
        opacity: 0.7;
      }
    }

    @keyframes heartBeat {
      0%, 100% {
        transform: scale(1);
      }
      50% {
        transform: scale(1.2);
      }
    }

    .prize-card {
      position: relative;
    }

    /* --- ã‚¹ãƒãƒ›å‘ã‘ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆèª¿æ•´ --- */
    @media (max-width: 480px) {
      body {
        padding: 8px;
      }
      .app {
        padding: 10px;
        border-radius: 12px;
        box-shadow: 0 4px 10px rgba(0,0,0,0.06);
      }
      .inner {
        padding: 10px 10px 14px;
        border-radius: 12px;
      }
      h1 {
        font-size: 18px;
      }
      .subtitle {
        font-size: 11px;
      }
      button {
        width: 100%;
        padding: 18px 48px;
        font-size: 20px;
        font-weight: 700;
      }
      .result {
        font-size: 14px;
      }
      .prize-list {
        grid-template-columns: repeat(2, minmax(0,1fr));  /* ã‚¹ãƒãƒ›ã‚‚2åˆ— */
      }
      .prize-card img {
        width: 44px;
        height: 44px;
      }
    }
  </style>
</head>
<body>
  <div class="app">
    <div class="inner">
      <h1>ãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆï¼ã€Œã‚·ãƒ¼ãƒ«ã¨ã‹ã‚‚ã‚‰ãˆï½ã‚‹ã€</h1>

      <div class="controls">
        <button id="spinBtn">ã¾ã‚ã™ï¼</button>
        <button id="resetBtn" class="reset-btn" title="æœ€åˆã«æˆ»ã™">â†»</button>
      </div>

      <div class="wheel-wrapper">
        <div class="pointer"></div>
        <canvas id="wheelCanvas" width="400" height="400"></canvas>
        <div class="sparkles" id="sparkles"></div>
      </div>

      <div class="result" id="result"></div>
      <div class="prize-list" id="prizeList"></div>

      <div class="footer-note">created byğŸ’›@ShinMekicoWorks</div>
    </div>
  </div>

  <script>
    /* --- ã‚·ãƒ¼ãƒ«è¨­å®šï¼ˆç”»åƒãƒ•ã‚¡ã‚¤ãƒ«åã‚’åˆã‚ã›ã¦ãã ã•ã„ï¼‰ --- */
    const prizes = [
      { name: 'ç¥è©±ã®æ¡ˆå†…äºº ãƒŸã‚¹ãƒŸ',   imageSrc: 'flower.png' },
      { name: 'ãƒ‹ãƒƒãƒˆå¸½ã® ãƒ‹ã‚³', imageSrc: 'hatgirl.png' },
      { name: 'ãƒ–ãƒ«ãƒ¼ãƒ™ãƒªãƒ¼ãª ãƒ‹ã‚³', imageSrc: 'purple.png' },
      { name: 'ãƒ‹ã‚³ã®ã‚­ãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼', imageSrc: 'keyholder.png' },
      { name: 'ãƒ¡ã‚­ã‚³ã‚·ãƒ¼ãƒ«A', imageSrc: 'mekicoA.png' },  // â† è¿½åŠ 
      { name: 'ãƒ¡ã‚­ã‚³ã‚·ãƒ¼ãƒ«B', imageSrc: 'mekicoB.png' }   // â† è¿½åŠ 
    ];

    const canvas = document.getElementById('wheelCanvas');
    const ctx = canvas.getContext('2d');
    const radius = canvas.width / 2;
    const spinBtn = document.getElementById('spinBtn');
    const resultEl = document.getElementById('result');
    const prizeListEl = document.getElementById('prizeList');
    const sparklesEl = document.getElementById('sparkles');
    const pointerAngle = 0;  // 15æ™‚ã®ä½ç½®ï¼ˆ0åº¦ = 3æ™‚ï¼‰
    let spinning = false;

    // ã‚­ãƒ©ã‚­ãƒ©ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ã‚’ç”Ÿæˆ
    function createSparkles() {
      sparklesEl.innerHTML = '';
      const wheelWrapper = document.querySelector('.wheel-wrapper');
      const rect = wheelWrapper.getBoundingClientRect();
      const centerX = rect.width / 2;
      const centerY = rect.height / 2;
      
      for (let i = 0; i < 20; i++) {
        const sparkle = document.createElement('div');
        sparkle.className = 'sparkle';
        
        const angle = Math.random() * Math.PI * 2;
        const distance = 80 + Math.random() * 80;
        const x = centerX + Math.cos(angle) * distance;
        const y = centerY + Math.sin(angle) * distance;
        
        sparkle.style.left = x + 'px';
        sparkle.style.top = y + 'px';
        sparkle.style.animationDelay = (Math.random() * 2) + 's';
        sparkle.style.animationDuration = (1.5 + Math.random()) + 's';
        
        sparklesEl.appendChild(sparkle);
      }
    }

    function showSparkles() {
      createSparkles();
      sparklesEl.classList.add('active');
    }

    function hideSparkles() {
      sparklesEl.classList.remove('active');
    }

    // å½“é¸ã—ãŸæ™¯å“ã‚«ãƒ¼ãƒ‰ã«ãƒãƒ¼ãƒˆã‚­ãƒ©ã‚­ãƒ©ã‚’è¿½åŠ 
    function addHeartsToCard(cardElement) {
      // æ—¢å­˜ã®ãƒãƒ¼ãƒˆã‚’ã‚¯ãƒªã‚¢
      const existingContainer = cardElement.querySelector('.heart-container');
      if (existingContainer) {
        existingContainer.remove();
      }

      const container = document.createElement('div');
      container.className = 'heart-container';
      
      // ã‚«ãƒ¼ãƒ‰å³å´ï¼ˆç”»åƒã®å³ï¼‰ã«5å€‹ã®ãƒãƒ¼ãƒˆã‚’é…ç½®
      // ç¸¦æ–¹å‘ã«å‡ç­‰ã«é…ç½®ã—ã¦é‡ãªã‚‰ãªã„ã‚ˆã†ã«ã™ã‚‹
      const positions = [
        { x: 65, y: 15 },
        { x: 80, y: 30 },
        { x: 70, y: 50 },
        { x: 85, y: 70 },
        { x: 75, y: 85 }
      ];
      
      for (let i = 0; i < 5; i++) {
        const heart = document.createElement('div');
        heart.className = 'heart-sparkle';
        
        // å›ºå®šä½ç½®ã«å°‘ã—ãƒ©ãƒ³ãƒ€ãƒ æ€§ã‚’åŠ ãˆã‚‹
        const x = positions[i].x + (Math.random() * 10 - 5);
        const y = positions[i].y + (Math.random() * 8 - 4);
        
        heart.style.left = x + '%';
        heart.style.top = y + '%';
        
        // å„ãƒãƒ¼ãƒˆã”ã¨ã«ç•°ãªã‚‹å‹•ãã‚’ãƒ©ãƒ³ãƒ€ãƒ ã«è¨­å®š
        const delay = Math.random() * 2;
        const duration = 1.5 + Math.random() * 1.5; // 1.5-3ç§’
        const direction = Math.random() > 0.5 ? 'normal' : 'reverse';
        
        heart.style.animationDelay = delay + 's';
        heart.style.animationDuration = duration + 's';
        heart.style.animationDirection = direction;
        
        // ãƒ©ãƒ³ãƒ€ãƒ ã«åˆæœŸå›è»¢ã‚’è¨­å®š
        heart.style.transform = `rotate(${Math.random() * 360}deg)`;
        
        container.appendChild(heart);
      }
      
      cardElement.appendChild(container);
    }

    function drawWheel(rotation) {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      const sliceAngle = (Math.PI * 2) / prizes.length;

      for (let i = 0; i < prizes.length; i++) {
        const start = rotation + i * sliceAngle;
        const end = start + sliceAngle;

        ctx.beginPath();
        ctx.moveTo(radius, radius);
        ctx.arc(radius, radius, radius - 4, start, end);
        ctx.closePath();

        const hue = (i * 360 / prizes.length) % 360;
        ctx.fillStyle = `hsl(${hue}, 40%, 80%)`;
        ctx.fill();
        ctx.strokeStyle = '#fff';
        ctx.lineWidth = 2;
        ctx.stroke();

        ctx.save();
        ctx.translate(radius, radius);
        ctx.rotate(start + sliceAngle / 2);
        ctx.textAlign = 'right';
        ctx.fillStyle = '#8B4513';
        ctx.font = '16px system-ui';
        ctx.fillText(prizes[i].name, radius - 16, 5);
        ctx.restore();
      }

      // ä¸­å¤®ã®ç™½ã„å††
      ctx.beginPath();
      ctx.arc(radius, radius, 40, 0, Math.PI * 2);
      ctx.fillStyle = '#ffffff';
      ctx.fill();
      ctx.strokeStyle = '#ccc';
      ctx.lineWidth = 2;
      ctx.stroke();
    }

    function renderPrizeList(selectedIndex = null) {
      prizeListEl.innerHTML = '';
      prizes.forEach((p, i) => {
        const card = document.createElement('div');
        card.className = 'prize-card';
        if (i === selectedIndex) card.classList.add('selected');

        const img = document.createElement('img');
        img.src = p.imageSrc;
        img.alt = p.name;

        const nameDiv = document.createElement('div');
        nameDiv.className = 'name';
        nameDiv.textContent = p.name;

        card.appendChild(img);
        card.appendChild(nameDiv);
        prizeListEl.appendChild(card);

        // å½“é¸ã‚«ãƒ¼ãƒ‰ã«ãƒãƒ¼ãƒˆã‚’è¿½åŠ 
        if (i === selectedIndex) {
          addHeartsToCard(card);
        }
      });
    }

    function spin() {
      if (spinning) return;
      spinning = true;
      spinBtn.disabled = true;
      resetBtn.disabled = true;  // â† ãƒªãƒ­ãƒ¼ãƒ‰ãƒœã‚¿ãƒ³ã‚‚éæ´»æ€§åŒ–
      resultEl.textContent = '';
      renderPrizeList(null);
      showSparkles();

      const sliceAngle = (Math.PI * 2) / prizes.length;
      const targetRotation =
        (5 + Math.random() * 3) * Math.PI * 2 + Math.random() * Math.PI * 2;
      const duration = 4000;
      const startTime = performance.now();

      function easeOut(t) {
        return 1 - Math.pow(1 - t, 3);
      }

      function tick(now) {
        const t = Math.min((now - startTime) / duration, 1);
        const rot = targetRotation * easeOut(t);
        drawWheel(rot);

        if (t < 1) {
          requestAnimationFrame(tick);
        } else {
          hideSparkles();
          const finalR = targetRotation % (Math.PI * 2);
          // ãƒã‚¤ãƒ³ã‚¿ãƒ¼ã¯0åº¦ï¼ˆ3æ™‚ï¼‰ãªã®ã§
          let rel = -finalR;  // ãƒã‚¤ãƒŠã‚¹ã«ã—ã¦è¨ˆç®—
          while (rel < 0) rel += Math.PI * 2;
          const index = Math.floor(rel / sliceAngle) % prizes.length;

          const selected = prizes[index];
          resultEl.innerHTML = `çµæœ: <span>${selected.name}</span>`;
          renderPrizeList(index);

          spinning = false;
          spinBtn.disabled = false;
          resetBtn.disabled = false;  // â† ãƒªãƒ­ãƒ¼ãƒ‰ãƒœã‚¿ãƒ³ã‚‚å†æ´»æ€§åŒ–
        }
      }

      requestAnimationFrame(tick);
    }

    spinBtn.addEventListener('click', spin);

    // ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³
    const resetBtn = document.getElementById('resetBtn');
    resetBtn.addEventListener('click', () => {
      resultEl.textContent = '';
      renderPrizeList(null);
      hideSparkles();
      drawWheel(0);
    });

    // åˆæœŸè¡¨ç¤º
    drawWheel(0);
    renderPrizeList(null);

    // â–¼ PWA: Service Worker ç™»éŒ²
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./sw.js').catch(err => {
          console.log('SW registration failed', err);
        });
      });
    }
  </script>
</body>
</html>
